<!-- KOMPLETNY MODUŁ WYSZUKIWARKI FIRM Z TWOIMI STYLAMI I DZIAŁAJĄCYM SKRYPTEM -->
<!-- STYLE CSS -->
<style>
  .text-field {
    /* Twoje style dla pola tekstowego */
    margin-right: 10px;
    margin-bottom: 0px;
    padding: 11px 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 14px;
    width: 280px;
  }

  .button-primary-2 {
    /* Twoje style dla przycisku */
    display: inline-flex;
    padding: 8px 14px;
    justify-content: center;
    align-items: center;
    flex: 0 0 auto;
    gap: 4px;
    border-radius: 8px;
    border: none; /* Dodane dla pewności */
    background-color: rgb(151, 0, 197);
    background-image: linear-gradient(0deg, rgba(85, 85, 85, 0.08), rgba(236, 236, 236, 0.08));
    transition: all 300ms ease;
    font-family: Inter, sans-serif;
    color: rgb(255, 255, 255);
    font-size: 14px;
    line-height: 1.5;
    font-weight: 500;
    text-align: center;
    letter-spacing: -0.006em;
    text-decoration: none;
    white-space: nowrap;
    cursor: pointer;
    box-shadow: rgba(26, 25, 37, 0.06) 0px 8px 12px -4px, rgba(26, 25, 37, 0.12) 0px 4px 8px -4px, rgba(26, 25, 37, 0.12) 0px 2px 4px -1px, rgba(26, 25, 37, 0.12) 0px 1px 1.5px -0.5px, rgba(26, 25, 37, 0.12) 0px 0.75px 0.75px 0px, rgba(26, 25, 37, 0.24) 0px 0.25px 0.25px 0px, rgba(26, 25, 37, 0.08) 0px -8px 20px 0px inset, rgba(255, 255, 255, 0.08) 0px 1px 3px 0px inset, rgba(255, 255, 255, 0.08) 0px 0.75px 0.75px 0px inset, rgba(255, 255, 255, 0.12) 0px 0.25px 0.25px 0px inset;
  }

  .button-primary-2:hover {
    /* Twoje style dla hover */
    background-image: linear-gradient(0deg, rgba(85, 85, 85, 0.24), rgba(236, 236, 236, 0.08));
    box-shadow: rgba(26, 25, 37, 0.06) 0px 8px 12px -4px, rgba(26, 25, 37, 0.12) 0px 4px 8px -4px, rgba(26, 25, 37, 0.12) 0px 2px 4px -1px, rgba(26, 25, 37, 0.12) 0px 1px 1.5px -0.5px, rgba(26, 25, 37, 0.12) 0px 0.75px 0.75px 0px, rgba(26, 25, 37, 0.24) 0px 0.25px 0.25px 0px, rgba(26, 25, 37, 0.08) 0px -8px 20px 0px inset, rgba(255, 255, 255, 0.08) 0px 1px 3px 0px inset, rgba(255, 255, 255, 0.08) 0px 0.75px 0.75px 0px inset, rgba(255, 255, 255, 0.12) 0px 0.25px 0.25px 0px inset;
  }
</style>
<!-- ELEMENTY HTML Z TWOIMI STYLAMI I POPRAWNYMI ID -->
<div style="font-family: system-ui, Arial, sans-serif;">
  <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 10px;">
    <!-- Pole tekstowe z Twoimi stylami i ID="search-input" -->
    <input id="search-input" type="text" placeholder="Wpisz NIP lub nazwę firmy" class="text-field">
<!-- Przycisk z Twoimi stylami i ID="search-btn" -->
<button id="search-btn" type="button" class="button-primary-2">
  Pobierz dane
</button>
  </div>
  <!-- Kontenery na wyniki i statusy (zostają bez zmian) -->
  <div id="results" style="margin-top: 20px; max-height: 300px; overflow-y: auto;"></div>
  <div id="status" style="margin-top: 15px; font-weight: bold;"></div>
</div>
<!-- TWÓJ ORYGINALNY, DZIAŁAJĄCY SKRYPT (BEZ ZMIAN) -->
<script>
const API_URL = "https://automatyzacja.szalonyereer.workers.dev";

document.getElementById("search-btn").addEventListener("click", async () => {
  const query = document.getElementById("search-input").value.trim();
  const status = document.getElementById("status");
  const resultsDiv = document.getElementById("results");
  const btn = document.getElementById("search-btn");
  const oldText = btn.innerHTML;

  if (!query) { status.innerHTML = "<span style='color:red;'>Wpisz NIP lub nazwę</span>"; return; }

  btn.disabled = true; btn.innerHTML = "Szukam..."; status.innerHTML = ""; resultsDiv.style.display = "none";

  try {
    const isNip = /^\d{10}$/.test(query.replace(/[-\s]/g, ""));
    const endpoint = isNip ? `${API_URL}/nip?nip=${query.replace(/[-\s]/g, "")}` : `${API_URL}/nazwa?nazwa=${encodeURIComponent(query)}`;
    
    const res = await fetch(endpoint);
    const data = await res.json();

    if (!data || data.error) {
      status.innerHTML = `<span style="color:red;">${data?.error || "Brak wyników"}</span>`;
      return;
    }

    if (data.success && data.nip) {
      fillForm(data);
      status.innerHTML = '<span style="color:green;">Dane uzupełnione!</span>';
      return;
    }

    if (Array.isArray(data) && data.length > 0) {
      resultsDiv.style.display = "block";
      resultsDiv.innerHTML = "<strong>Wybierz firmę z listy:</strong><br><br>" + 
        data.slice(0, 15).map(f => `
          <div onclick="selectFirm('${f.nip}')" style="padding:12px; margin:6px 0; background:white; border:1px solid #ddd; border-radius:8px; cursor:pointer;">
            <strong>${f.name}</strong><br>
            <small>NIP: ${f.nip} | REGON: ${f.regon || ''} | ${f.city || ''}</small>
          </div>
        `).join("");
    } else {
        status.innerHTML = `<span style='color:orange;'>Nie znaleziono firmy.</span>`;
    }

  } catch (e) {
    status.innerHTML = '<span style="color:red;">Błąd serwera – spróbuj za chwilę</span>';
  } finally {
    btn.disabled = false; btn.innerHTML = oldText;
  }
});

async function selectFirm(nip) {
  const status = document.getElementById("status");
  const res = await fetch(`${API_URL}/nip?nip=${nip}`);
  const data = await res.json();
  fillForm(data);
  document.getElementById("results").style.display = "none";
  status.innerHTML = '<span style="color:green;">Gotowe!</span>';
}

function fillForm(d) {
  const set = (id, val) => { const el = document.getElementById(id); if (el) el.value = val || ""; };

  set("2", d.nip); // Zmienione z "1" na "2" dla spójności
  set("3", d.shortName || d.name);
  const fullAddress = [d.street, d.number, d.apartment].filter(Boolean).join(" ");
  set("4", fullAddress);
  set("5", d.postal);
  set("6", d.city);
  set("7", d.regon);
   set("8", d.name);
}
</script>
